---
title: "SQL Data checks"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse) 
library(DBI)
library(glue)
library(here)
library(miceadds)
library(rvest)
library(dm)
library(stringr)
#source(here("Functions","db_helper_functions.R"))
# Default file type is .R  if different need to sepcify
source.all(here("Functions"))
```

```{r}
dev_conn <- DBI::dbConnect(RSQLite::SQLite(), dbname = "drag_race_dev.sqlite")
```

```{sql name check rpdr, connection="dev_conn"}
select 
  *
FROM rpdr_contestants
WHERE lower(contestant) like 'dida%' 

```

```{sql name check data prog, connection="dev_conn"}
select 
  *
FROM dp_contestants
WHERE lower(contestant) like 'dida%' 

```

```{sql conestant checks step one, connection="dev_conn"}
-- Step one: Use except clause to see who is missing 
-- I already kjnow that the rpdr_contestant has more data than dp_contestants 
-- but for good measure want to make sure there aren't any misspellings 
-- because contestant is going to be used as a join key 
with drag_racer AS
(
  SELECT season, contestant FROM rpdr_contestants WHERE season<12
  
),
data_progress AS
(

  SELECT season, contestant FROM dp_contestants
),
drag_racer_top AS
(

  SELECT season, contestant FROM drag_racer
  
    EXCEPT 
  
  SELECT season, contestant FROM data_progress 
),
data_progress_top AS 
(
  SELECT season, contestant FROM data_progress 
  
    EXCEPT 
    
  SELECT season, contestant FROM rpdr_contestants
  
),
union_table AS 
(
  SELECT 'Missing in Data Progress' AS except_condition, season, contestant FROM drag_racer_top
  
    UNION ALL 
  
  SELECT 'Missing in DragRaceR' AS except_condition, season, contestant FROM data_progress_top 

)

SELECT 
  * 
FROM union_table
ORDER BY contestant

```
